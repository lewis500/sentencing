<!DOCTYPE html>
<meta charset="utf-8">
<link href='http://fonts.googleapis.com/css?family=Fenix' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="tooltip.css">
<style>

  body{
    font-family: Fenix, serif;
    font-size: 11;
    /*width: 620px;*/
  }


  #states {
    fill: #aaa;
  }

  #states .active {
    fill: orange;
  }

  #state-borders {
    fill: none;
    stroke: #fff;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
  }

  span{
    /*color: pink;*/
    font-weight: bold;
    text-transform: uppercase;
  }

  .state{
    stroke: none;
    stroke-width: 3px;
  }

</style>
<script src="http://d3js.org/d3.v3.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
<script src="d3-tip.js"></script>


<body>

<div class=".d3-tip"></div>

</body>

<script src="map.js"></script>
<script src="rates.js"></script>


<script>


var rateById = d3.map();

// var color = d3.scale.ordinal().domain([1,2,3,4,5]).range(["#009ed8","#80e28e","#e9ec32","#f6a023","#f37124"])

var color = d3.scale.ordinal().domain([1,2,3,4,5]).range(['rgba(215,25,28,.8)','rgb(253,174,97)','rgb(255,255,191)','rgb(171,221,164)','rgb(43,131,186)'].reverse())

rates.forEach(function(d) { rateById.set(d.id, color(+d.restriction)); });

us.objects.states.geometries.forEach(function(d){
  d.properties = rates.filter(function(v){return +v.id == +d.id;})[0];
});

var rests = d3.scale.ordinal().domain([1,2,3,4,5]).range(['No restriction','Inmates only','Inmates & Parolees', 'Inmates, Parolees, & Probationers', 'Inmates, Parolees, Probationers, & Ex-felons']);

var width = 960,
  height = 500,
  centered;

var projection = d3.geo.albersUsa()
    .scale(1070)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var margin = {top: 50, left: 50, right: 10, bottom: 10};

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);


var g = svg.append("g").attr("transform", "translate(" + margin.top + "," + margin.left + ")");

/* Initialize tooltip */
var tip = d3.tip().html(function(d) { return d; });

/* Invoke the tip in the context of your visualization */
svg.call(tip);

tip.attr("class","d3-tip");


g.append("g")
    .attr("id", "states")
  .selectAll("path")
      .data(topojson.feature(us, us.objects.states).features)
  .enter().append("path")
    .attr("class","state-area")
    .attr("fill", function(d) { return rateById.get(d.id); })
    .attr("d", path)
    // .attr("stroke","white")
    // .attr("stroke-width","1.5px")
  .on('mouseover', function(d){
    // d3.select(this).transition().duration(50).attr("stroke","#888").attr("stroke-width","3px")
    var p = d.properties
    return tip.show( '<span>' + p.name + '</span><br>' + rests(p.restriction))
  })
  .on('mouseout', function(d){
        // d3.select(this).transition().duration(50).attr("stroke","white").attr("stroke-width","1.5px")
        tip.hide()
  })

g.append("path")
    .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
    .attr("id", "state-borders")
    .attr("d", path);


</script>

